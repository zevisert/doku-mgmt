apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
configurations:
- https://appdat.jsc.nasa.gov/appdat/kpt-packages/-/raw/master/kustomizeconfig/cert-manager.yaml
resources:
- cluster-issuer.yaml
patches:
- patch: |
    - op: add
      path: /spec/template/spec/containers/0/args/-
      value: --default-issuer-name=$(DEFAULT_ISSUER_NAME)
    - op: add
      path: /spec/template/spec/containers/0/args/-
      value: --default-issuer-kind=$(DEFAULT_ISSUER_KIND)
  target:
    kind: Deployment
    name: cert-manager
replacements:
- source:
    kind: ClusterIssuer
    name: letsencrypt-prod
    fieldPath: kind
  targets:
  - select:
      kind: Deployment
      name: cert-manager
    fieldPaths:
    - spec.template.spec.containers.[name=cert-manager].env.[name=DEFAULT_ISSUER_KIND].value
    options:
      create: true
- source:
    kind: ClusterIssuer
    name: letsencrypt-prod
    fieldPath: metadata.name
  targets:
  - select:
      kind: Deployment
      name: cert-manager
    fieldPaths:
    - spec.template.spec.containers.[name=cert-manager].env.[name=DEFAULT_ISSUER_NAME].value
    options:
      create: true
